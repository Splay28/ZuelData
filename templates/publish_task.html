<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)

	以上为模板信息
	作者 Splay28
-->
<html>
	<head>
		<title>发布待办</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.png') }}">
		<link rel="stylesheet" href={{ url_for("static",filename = "main/assets/css/main.css" ) }} />
		<script src={{ url_for("static",filename = "main/assets/js/jquery.min.js" ) }}></script>
		<script src={{ url_for("static",filename = "tinymce/js/tinymce/tinymce.min.js" ) }}></script>
		<script src={{ url_for("static",filename = "tinymce/tinymce_setup.js" ) }}></script>
		<script>
			function get_content(){
				var data = '{{data|tojson}}';
				data = JSON.parse(data)
				var type = '{{type}}';

				emailstr=''
				for(let i=0;i<data['from'].length;i++){
					emailstr+=(data['from'][i][2]+',')
				}
				emailstr=emailstr.slice(0,-1)
				$('#email').prop('value', emailstr)
				$('#quota_id').hide()
				$('#to').hide()
				if(type == 'publish'){
					$('#quota_box').hide()
				}
				else{
					$('#main_form').prop('action',"/api/task/publish?type=reply&url="+data['task'][0]);
					let finish='<li><a id="finish_a" href="#" class="button big">结案</a></li>'
					$('#actions').append(finish)

					$('#title_page').html('回复待办')
					$('#reset').hide()
					$('#submit').prop('value','回复')
					$('#lawsuit_box').html('发送给：')
					$('#history').html("共" + data['quota'].length + "次回信")
					let q_ids=''
					for(let i=0;i<data['quota'].length;i++){
						let tr=document.createElement("tr");
						let a=document.createElement("a");
						a.href='/task/content?url='+data['quota'][i][0];
						q_ids+=(data['quota'][i][0]+',')
						a.innerHTML=data['quota'][i][1]
						let title=document.createElement("td");
						title.appendChild(a);
						let from_t=data['quota'][i][2]['from'];
						let to_t=data['quota'][i][2]['to'];
						let from=document.createElement("td");
						let to=document.createElement("td");
						let subd=document.createElement("td");
						subd.innerHTML=data['quota'][i][3];

						for(let i=0;i<from_t.length;i++){
							let a0=document.createElement("a");
							a0.style="margin: 0px 1em 0px 0px;";
							a0.href='/user/base?url='+from_t[i][0];
							a0.innerHTML=from_t[i][1];
							from.appendChild(a0)
						}
						for(let i=0;i<to_t.length;i++){
							let a0=document.createElement("a");
							a0.style="margin: 0px 1em 0px 0px;";
							a0.href='/user/base?url='+to_t[i][0];
							a0.innerHTML=to_t[i][1];
							to.appendChild(a0)
						}
						tr.append(title,from,to,subd);
						$('#quotab').append(tr)
					}
					$('#title').prop('value',data['task'][3])
					q_ids=q_ids.slice(0,-1)
					$('#quota_id').prop('value',q_ids)
				}

				let to_ids='';
				for(let i=0;i<data['to'].length;i++){
					let to0=document.createElement("a");
					to0.href='/user/base?url='+data['to'][i][0];
					to_ids+=(data['to'][i][0]+',')
					to0.innerHTML=data['to'][i][1];
					to0.style="margin: 0px 1em 0px 0px;"
					$('#lawsuit_box').append(to0);
				}
				to_ids=to_ids.slice(0,-1)
				$('#to').prop('value',to_ids)

				
				$("#finish_a").click(function(){
					$('#main_form').prop('action',"/api/task/publish?type=finish&url="+data['task'][0]);
					$('#submit').click()
				});

			}
		</script>
	</head>
	<body class="is-preload" onload="get_content()">
		
		<!-- Wrapper -->
		<div id="wrapper">

			<!-- Main -->
				<div id="main">
					<div class="inner">

						<!-- Header -->
							<header id="header">
								<a href="/index" class="logo"><strong>中南数据</strong></a>
							</header>

							<!-- Content -->
								<section>
									<header class="main">
										<h1 id="title_page">创建待办</h1>
									</header>

									<!-- Content -->
									<h3>案件信息</h3>
									<p>注：一经创建，<b>无法删除</b>，请谨慎填写</p>

									<form id="main_form" method="post" action="/api/task/publish" enctype="multipart/form-data">
										<div class="row gtr-uniform">
											<div class="col-6 col-12-xsmall">
												<input type="file" multiple="multiple" id="file" name="file"/>
											</div>
											<div class="col-6 col-12-xsmall">
												<input type="text" name="title" id="title" value="" placeholder="案件标题" maxlength="100"/>
												<label for="title">在此输入案件标题</label>
											</div>
											<!-- Break -->
											<div class="col-12">
												<input type="text" name="email" id="email" value="" placeholder="在此输入志愿者的邮箱，多位志愿者用半角逗号 , 隔开，用于确定任务的发起人，请认真填写" />
												<label for="email">在此输入志愿者的邮箱，多位志愿者用半角逗号 , 隔开，用于确定任务的发起人，请认真填写</label>
												<textarea name="abstract" id="abstract" value="" placeholder="在这里输入案件摘要，例如：诉讼部同学你们好！这是 __组别__ 接待的当事人希望我们代写的文书，系 __纠纷，烦请审批，辛苦啦！" required="required" rows="6" maxlength="500"></textarea>
												<label for="abstract">在这里输入案件摘要，例如：诉讼部同学你们好！这是 __组别__ 接待的当事人希望我们代写的文书，系 __纠纷，烦请审批，辛苦啦！</label>
												<div id="lawsuit_box" class="box" style="margin-bottom: 0;">今日诉讼部当班人员：</div>
												<p><b>如需更改待办收件人，请联系执行主任</b></p>
												<input type="text" name="quota_id" id="quota_id" value="" />
												<input type="text" name="to" id="to" value="" />
												<div id="quota_box" class="table-wrapper">
													<h4>引用自以下待办</h4>
													<table>
														<thead>
															<tr>
																<th>标题</th>
																<th>来自</th>
																<th>发给</th>
																<th>提交日期</th>
															</tr>
														</thead>
														<tbody id="quotab">
														</tbody>
														<tfoot>
															<tr>
																<td colspan="2"></td>
																<td id="history"></td>
															</tr>
														</tfoot>
													</table>
												</div>
											</div>
											
											<!-- Break -->
											<div class="col-12">
												<ul id="actions" class="actions">
													<li><input id="submit" type="submit" value="上传" class="primary" /></li>
													<li><input id="reset" type="reset" value="重置" /></li>
												</ul>
											</div>

											<div id="quotas" class="col-12">
											</div>
										</div>
									</form>

								</section>

						</div>
					</div>

{% include "partial/footer.html" %}